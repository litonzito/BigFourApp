@model IEnumerable<BigFourApp.Models.Notificacion>

@{
    ViewData["Title"] = "Notificaciones";
    var hasNotifications = Model != null && Model.Any();
    var userName = hasNotifications ? Model.First().Usuario?.UserName : null;
}

@functions {
    public (string Subject, string Body) ParseMessage(string mensaje)
    {
        if (string.IsNullOrWhiteSpace(mensaje))
            return ("(Sin asunto)", "(Sin contenido)");

        string subject = "";
        string body = "";

        int subjectIndex = mensaje.IndexOf("Subject:");
        int bodyIndex = mensaje.IndexOf("Body:");

        if (subjectIndex >= 0 && bodyIndex > subjectIndex)
        {
            subject = mensaje.Substring(subjectIndex + 8, bodyIndex - (subjectIndex + 8)).Trim();
            body = mensaje.Substring(bodyIndex + 5).Trim();
        }
        else
        {
            // fallback si no tiene formato
            body = mensaje;
        }

        return (subject, body);
    }
}
<style>
    body {
        background: linear-gradient(135deg, #f0f4ff, #e8efff);
        font-family: "Poppins", sans-serif;
        color: #333;
    }
    .notifs-wrapper {
        padding: 32px 0 48px;
    }
    .notifs-container {
        max-width: 1100px;
        margin: 0 auto;
    }
    .notifs-card {
        background: #fff;
        border-radius: 18px;
        padding: 32px;
        box-shadow: 0 18px 50px rgba(23, 37, 84, 0.12);
        border: 1px solid #e2e8f0;
        min-height: 420px;
    }
    .notifs-title {
        font-size: 28px;
        font-weight: 700;
        color: #0f172a;
        margin-bottom: 24px;
    }
    .table-container {
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        background: #fdfdff;
        overflow: hidden;
    }
    .notif-table th {
        background: #f8fafc;
        color: #1f2937;
        font-weight: 600;
    }
    .notif-table th, .notif-table td {
        vertical-align: middle;
        padding: 14px 18px;
    }
    .msg-section strong {
        display: block;
        color: #111827;
        margin-top: 4px;
    }
    .msg-block {
        background: #f1f5f9;
        border-radius: 10px;
        padding: 10px 12px;
        margin-bottom: 10px;
    }
    .btn-delete {
        background: #ef4444;
        color: #fff;
        border: none;
        padding: 10px 16px;
        border-radius: 10px;
        font-weight: 600;
        transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.2s ease;
    }
    .btn-delete:hover {
        background: #dc2626;
        box-shadow: 0 10px 30px rgba(239, 68, 68, 0.25);
        transform: translateY(-1px);
    }
    .empty-box {
        min-height: 320px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 32px;
        color: #6b7280;
    }
    .empty-box h2 {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 8px;
        color: #111827;
    }
    .empty-box p {
        margin: 0;
        font-size: 15px;
    }
</style>
<div class="notifs-wrapper">

    <div class="notifs-container">

        <div class="notifs-card">

            <h1 class="notifs-title">
                Notificaciones@(string.IsNullOrWhiteSpace(userName) ? "" : $" - {userName}")
            </h1>

            @if (hasNotifications)
            {
                <div class="table-container">
                    <table class="table table-hover notif-table">
                        <thead class="notif-thead">
                            <tr>
                                <th>Mensaje</th>
                                <th>Tipo</th>
                                <th>Fecha</th>
                                <th></th>
                            </tr>
                        </thead>

                        <tbody>
                            @foreach (var item in Model)
                            {
                                var parsed = ParseMessage(item.Mensaje);
                                <tr>
                                    <td>
                                        <div class="msg-section">
                                            <strong>Subject:</strong>
                                            <div class="msg-block">@parsed.Subject</div>

                                            <strong>Body:</strong>
                                            <div class="msg-block">@parsed.Body</div>
                                        </div>
                                    </td>
                                    <td>@item.Tipo</td>
                                    <td>@item.fecha.ToString("dd/MM/yyyy HH:mm")</td>

                                    <td class="text-end">
                                        <form asp-controller="Notificaciones"
                                              asp-action="EliminarNotificacion"
                                              asp-route-id="@item.Id_Notificacion"
                                              method="post">

                                            <button type="submit" class="btn-delete">
                                                Eliminar
                                            </button>

                                        </form>
                                    </td>
                                </tr>
                            }
                        </tbody>

                    </table>
                </div>
            }
            else
            {
                <div class="table-container">
                    <div class="empty-box">
                        <div>
                            <h2>Sin notificaciones</h2>
                            <p>No tienes notificaciones aun. Cuando lleguen, apareceran aqui.</p>
                        </div>
                    </div>
                </div>
            }

        </div>

    </div>
</div>
